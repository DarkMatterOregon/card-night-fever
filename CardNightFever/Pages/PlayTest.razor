@page "/GhettoPlayTest"
@using CardNightFever.Data;
@using CardNightFever.Shared;
@using Blazor.DragDrop.Core;

<h3>PlayTest</h3>

@if (_deck == null || players.Count < 1 || _pile == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <h4>The deck count: @_deck.Cards.Count</h4>
    int playerNum = 1;
    string playerText = "player " + playerNum.ToString();
    foreach (PlayerHand p in players)
    {
        <h4>Player @playerNum Hand Count: @p.HandSize</h4>
        @if (!p.IsEmpty)
        {
            <Dropzone Name="@playerText" Class="row">
                @foreach (var card in p.Cards)
                {
                    <Draggable Tag='card.Rank.ToString() + "_" + card.Suit.ToString()'>
                        <Card PlayingCard="@card" />
                    </Draggable>
                }
            </Dropzone>
        }
        else
        {
            <button onclick="@DrawFullHand(p)">@playerText Draw</button>
        }
        playerNum++;
    }
    <h4>Discard pile Count: @_pile.Cards.Count</h4>
}

@code {
    private Deck _deck;
    private List<PlayerHand> players = new List<PlayerHand>();
    private DiscardPile _pile;

    protected override async Task OnInitializedAsync()
    {
        _deck = new Deck();
        players.Add(new PlayerHand(1));
        players.Add(new PlayerHand(2));
        _pile = new DiscardPile();
    }

    protected async Task CreateDeck(Deck deck)
    {
        deck.CreateDeck();
        this.StateHasChanged();
    }

    protected async Task DrawFullHand(PlayerHand player)
    {
        if (_deck.HasMin)
        {
            player.FillHand(_deck);
        }
        else
        {

        }
        this.StateHasChanged();
    }

    protected async Task DrawCard(PlayerHand player)
    {
        if (!_deck.IsEmpty)
        {
            player.DrawCard(_deck);
        }
        else
        {

        }
        this.StateHasChanged();
    }

    protected async Task Discard(PlayerHand player, int index)
    {
        if (!_deck.IsEmpty)
        {
            player.Discard(_pile, index);
        }
        else
        {

        }
        this.StateHasChanged();
    }

    protected async Task<int> GetScore(PlayerHand player)
    {
        return player.Score;
    }
}